<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Live Previewer</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked.js for markdown parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.0/marked.min.js"></script>
    <!-- Footnote extension for Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked-footnote@1.2.2/dist/index.umd.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Markdown Preview Styling */
        .prose pre {
            background-color: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
        }
        .prose code {
            font-family: 'JetBrains Mono', monospace;
            background-color: #f3f4f6;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
        }
        .prose h1 { font-size: 1.875rem; font-weight: 700; margin-bottom: 1rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem; }
        .prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.75rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.25rem; }
        .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.25rem; margin-bottom: 0.5rem; }
        .prose p { margin-bottom: 1rem; line-height: 1.6; }
        
        /* Link styling */
        .prose a {
            color: #2563eb;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }
        .prose a:hover {
            color: #1d4ed8;
            text-decoration: underline;
        }

        /* Footnote styling */
        .prose .footnotes {
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
            font-size: 0.875rem;
            color: #4b5563;
        }
        .prose .footnotes-title {
            display: none; /* Default title hidden to customize if needed */
        }
        .prose sup a {
            font-size: 0.75rem;
            margin-left: 0.1rem;
            padding: 0 0.2rem;
        }

        .prose ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; }
        .prose ol { list-style-type: decimal; padding-left: 1.5rem; margin-bottom: 1rem; }
        .prose blockquote { border-left: 4px solid #d1d5db; padding-left: 1rem; color: #4b5563; font-style: italic; margin-bottom: 1rem; }
        .prose table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        .prose th, .prose td { border: 1px solid #e5e7eb; padding: 0.5rem; text-align: left; }
        .prose th { background-color: #f9fafb; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

        .editor-textarea {
            font-family: 'JetBrains Mono', monospace;
            resize: none;
            outline: none;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 px-6 py-3 flex justify-between items-center shadow-sm z-10">
        <div class="flex items-center space-x-2">
            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
            <h1 class="text-xl font-bold text-gray-800">Markdown Previewer</h1>
        </div>
        <div class="flex space-x-4">
            <button onclick="copyMarkdown()" class="text-sm bg-white border border-gray-300 px-3 py-1.5 rounded-md hover:bg-gray-50 transition-colors flex items-center">
                <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                Copy Markdown
            </button>
            <button onclick="downloadMarkdown()" class="text-sm bg-indigo-600 text-white px-3 py-1.5 rounded-md hover:bg-indigo-700 transition-colors flex items-center">
                <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                Download .md
            </button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar: Cheat Sheet -->
        <aside class="w-64 bg-white border-r border-gray-200 overflow-y-auto hidden lg:block p-4">
            <h2 class="font-semibold text-gray-700 mb-4 flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Markdown 記法
            </h2>
            <div class="space-y-4 text-sm">
                <section>
                    <h3 class="text-gray-500 font-medium mb-1">見出し</h3>
                    <code class="block bg-gray-100 p-1 rounded"># 見出し 1</code>
                </section>
                <section>
                    <h3 class="text-gray-500 font-medium mb-1">リンク・参照</h3>
                    <code class="block bg-gray-100 p-1 rounded">[タイトル](URL)</code>
                    <code class="block bg-gray-100 p-1 rounded">[ID]: URL (参照)</code>
                </section>
                <section>
                    <h3 class="text-gray-500 font-medium mb-1 text-indigo-600 font-bold">脚注 (New!)</h3>
                    <code class="block bg-gray-100 p-1 rounded">文中に[^1]を書く</code>
                    <code class="block bg-gray-100 p-1 rounded">[^1]: ここに注釈</code>
                </section>
                <section>
                    <h3 class="text-gray-500 font-medium mb-1">リスト</h3>
                    <code class="block bg-gray-100 p-1 rounded">- 箇条書き</code>
                    <code class="block bg-gray-100 p-1 rounded">1. 番号付き</code>
                </section>
                <section>
                    <h3 class="text-gray-500 font-medium mb-1">コード</h3>
                    <code class="block bg-gray-100 p-1 rounded">`inline` / \`\`\` code \`\`\`</code>
                </section>
            </div>
        </aside>

        <!-- Main Content: Editor and Preview -->
        <main class="flex-1 flex flex-col md:flex-row overflow-hidden">
            <!-- Editor Section -->
            <div class="flex-1 flex flex-col border-r border-gray-200">
                <div class="bg-gray-100 px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider flex justify-between">
                    <span>Editor (Markdown)</span>
                    <span id="char-count">0 文字</span>
                </div>
                <textarea 
                    id="markdown-input" 
                    class="editor-textarea flex-1 p-6 text-gray-800 leading-relaxed text-sm bg-white"
                    placeholder="ここにマークダウンを入力してください..."
                ></textarea>
            </div>

            <!-- Preview Section -->
            <div class="flex-1 flex flex-col bg-white">
                <div class="bg-gray-100 px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">
                    Preview
                </div>
                <div 
                    id="preview-output" 
                    class="flex-1 p-8 overflow-y-auto prose max-w-none"
                >
                    <!-- Markdown rendered here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-6 right-6 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg transform translate-y-20 transition-transform duration-300 pointer-events-none">
        Copied to clipboard!
    </div>

    <script>
        const input = document.getElementById('markdown-input');
        const output = document.getElementById('preview-output');
        const charCount = document.getElementById('char-count');
        const toast = document.getElementById('toast');

        // Initial default content
        const defaultContent = `# 脚注機能のテスト

この文章には脚注が含まれています[^1]。
また、別の注釈も追加できます[^脚注2]。

## 脚注の書き方
1. 文中に \`[^ID]\` を書く
2. 離れた場所に \`[^ID]: 説明文\` を書く

プレビュー画面の下の方を確認してみてください。自動的に「Footnotes」セクションが作成されます。

[^1]: これが一つ目の脚注です。
[^脚注2]: 日本語のIDも使えます。
`;

        // Configure Marked.js with Footnote extension
        // Note: marked-footnote adds support for the [^1] syntax
        const { markedFootnote } = window;
        marked.use(markedFootnote());
        
        marked.setOptions({
            breaks: true,
            gfm: true,
            headerIds: false,
            mangle: false
        });

        // Update Preview Function
        function updatePreview() {
            const text = input.value;
            // Use marked.parse for latest versions of marked
            output.innerHTML = marked.parse(text);
            charCount.textContent = `${text.length} 文字`;
        }

        // Input Event Listener
        input.addEventListener('input', updatePreview);

        // Copy Function
        function copyMarkdown() {
            const text = input.value;
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            showToast('クリップボードにコピーしました！');
        }

        // Download Function
        function downloadMarkdown() {
            const text = input.value;
            const blob = new Blob([text], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'document.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Toast Notification
        function showToast(message) {
            toast.textContent = message;
            toast.classList.remove('translate-y-20');
            setTimeout(() => {
                toast.classList.add('translate-y-20');
            }, 2000);
        }

        // Initialize
        window.onload = () => {
            input.value = defaultContent;
            updatePreview();
        };
    </script>
</body>
</html>